---
title: 『笔记』MySQL数据类型、索引知识点汇总
tags:
  - 笔记
  - mysql
date: 2019-10-18 12:56:56
---


腾讯云搞数据库诊断大赛，提供了一份入门课程，这就拿来复习一下。

本文记录课程前两章（数据类型、索引）的知识点。

## MySQL数据类型

数据类型主要三大类：数据类型、日期/时间类、字符串类型

### 数值类型

#### 整数

| 整数类型        | 字节数 |
| --------------- | ------ |
| `TINYINT`       | 1      |
| `SMALLINT`      | 2      |
| `MEDIUMINT`     | 3      |
| `INT`/`INTEGER` | 4      |
| `BITINT`        | 8      |

<!--more-->

##### 有关显示宽度

显示宽度通过类型后的小括号内的数字`M`设定。

当插入数字宽度大于`M`时，显示时能够完全显示。

当插入数字宽度小于`M`时，显示时显示宽度为 `M`。

##### 有关UNSIGNED

在 MySQL 数据库中，对于UNSIGNED数值的操作，其返回值都是UNSIGNED 的。在UNSIGNED数值的操作下，要获得-1，需要对SQL_MODE参数进行设置：

```sql
> set sql_mode='NO_UNSIGNED_SUBTRACTION';
```

建议还是不要使用UNSIGNED，因为通常INT解决不了的问题，使用UNSIGNED INT同样解决不了，而且还会引入其他问题。

但存储IP时，需要使用UNSIGNED。用INT UNSIGNED存储 IP 地址，且用`INET_ATON()`、`INET_NTOA()`进行转换。

##### 有关ZEROFILL

使用ZEROFILL参数时，MySQL会自动添加UNSIGNED属性。

ZEROFILL是个显示属性，在显示时为数字前填充`0`。

#### 浮点数和定点数（小数）

| 类型                             | 字节数 |
| -------------------------------- | ------ |
| `FLOAT`                          | 4      |
| `DOUBLE`/`REAL`                  | 8      |
| `DECIMAL(M,D)`/`NUMERIC`/`FIXED` | M+2    |

##### 有关精度

M是数据位数（精度）的总数（小数点不算位数），D是小数点（标度）后面的位数。

需要高精度存储时，不要使用`FLOAT`和`DOUBLE`类型，使用`DECIMAL`。

#### 位值

| 类型     | 字节数  |
| -------- | ------- |
| `BIT(M)` | (M+7)/8 |

#### 布尔值

| 类型                          | 字节数 |
| ----------------------------- | ------ |
| `BOOLEAN`/`BOOL`/`TINYINT(1)` | 1      |

MySQL数据库产品没有真正实现对布尔类型的支持，在使用的时候，它和普通的TINYINT一样。

### 日期与时间类型

| 数据类型    | 字节数 | 取值范围                                |
| ----------- | ------ | --------------------------------------- |
| `YEAR`      | 1      | 1901-2155                               |
| `DATE`      | 3      | 1000-01-01~9999-12-31                   |
| `TIME`      | 3      | -838:59:59~838:59:59                    |
| `DATETIME`  | 8      | 1000-01-01 00:00:00~9999-12-31 23:59:59 |
| `TIMESTAMP` | 4      | 19700101000001~20380119031407           |

#### YEAR

格式：

* YYYY

插入2000年时需要用字符型`'0'`或`'00'`，否则会变成`'0000'`。

#### TIME

不仅可以用来表示时刻，还可以表示时间间隔。

格式：

- D HH:MM:SS.fraction
- HH:MM:SS.fraction
- HH:MM:SS
- HH:MM
- D HH:MM:SS
- D HH:MM
- D HH
- SS
- 不能是 MM:SS

D表示日，取值范围0<=D<=34。

#### DATETIME

格式：

* YYYY-MM-DD HH:MM:SS
* YY-MM-DD HH:MM:SS
* YYYY/MM/DD HH+MM+SS
* YYYYMMDDHHMMSS
* ...

任何标点符都可以用做日期部分或时间部分之间的间割符，也可以不使用间隔符。

#### DATE

格式：

* YYYY-MM-DD
* YY-MM-DD

MySQL规定，日期总以“年-月-日”为顺序。

#### TIMESTAMP

格式：

* YYYY-MM-DD HH:MM:SS

##### 自动初始化

DEFAULT CURRENT_TIMESTAMP

插入时如未给出具体值，则自动取值为当前时间戳。

##### 自动更新

ON UPDATE CURRENT_TIMESTAMP

修改当前行数据时，其中的TIMESTAMP列将自动更新值为当前时间戳。

自动初始化属性或自动更新属性仅能添加到一列数据。

### 字符串类型

| 类型           | 定义                         | 占用字节数（N代表一个字符占用的字节数）      |
| -------------- | ---------------------------- | -------------------------------------------- |
| `CHAR(M)`      | 定长字符串                   | M\*N                                         |
| `VARCHAR(M)`   | 变长字符串                   | M\*N + 1 或 M\*N + 2（1和2表示字符串的长度） |
| `BINARY(L)`    | 定长二进制串（无字符集）     | L                                            |
| `VARBINARY(L)` | 变长二进制串（无字符集）     | L+1                                          |
| `TEXT`         | 存储超长文本                 | M\*N+2                                       |
| `TINYTEXT`     |                              | M\*N+1                                       |
| `MEDIUMTEXT`   |                              | M\*N+3                                       |
| `LONGTEXT`     |                              | M\*N+4                                       |
| 各种`BLOB`     | 存储超长二进制串（无字符集） | L+？                                         |
| `ENUM`         | 枚举                         | 1或2                                         |
| `SET`          |                              |                                              |

### 高频使用类型

* 数值类型中，整形和DECIMAL用得多。
* 日期和时间类型中，DATETIME和TIMESTAMP用得多，性能要求高的用TIMESTAMP多一些。
* 字符串类型中，CHAR和VARCHAR用得多，TEXT在存储大量文本时用得较多。不建议使用BLOB。ENUM和SET用来存储性别、星期等还可以，如status、type一类的值，使用TINYINT更好。

## MySQL索引

### 数据结构

基础：二分查找、二叉树、平衡树、B树。

现今的数据库一般采用B+树作为索引的数据结构。MySQL里常用的索引数据结构有B+树索引和哈希索引两种。

### 优缺点及使用建议

索引用于快速检索。

#### 优点

* 提高数据检索效率
* 提高表之间的JOIN效率
* 利用唯一性索引，保证数据唯一性
* 提高排序和分组效率

#### 缺点

* 消耗更多的物理存储
* 数据变更时，索引也要更新，降低了更新效率（即减慢了写入速度）

总结一下，就是牺牲写入速度，换取查询速度。

#### 建议使用

* 经常检索的列
* 经常用于表连接的列
* 经常排序、分组的列

#### 不建议使用

* 基数很低的列
* 更新频繁而检索不频繁的列（写多读少）
* BLOB/TEXT等大字段列
* 很少用于检索的列

### 基本概念

索引是应用在 SQL 查询语句的条件，一般作为 WHERE 子句的条件。

实际上，索引也是一张表，该表保存了主键与索引字段，并指向实体表的记录。 

#### 约束

##### 主键约束（主键索引）

`PRIMARY KEY`

主键由表中的一个或多个字段组成，它的值用于唯一地标识表中的某一条记录。

主键的作用：

- 保证数据的完整性。
- 加快数据的操作速度。
- 最多只能有一个主键，不管什么引擎
- 主键值不能重复，也不能包含 NULL

主键设计建议：

* 对业务透明，无意义，免受业务变化的影响
* 主键要很少修改和删除
* 主键最好是自增的
* 不要具有动态属性，例如最后修改时间戳

##### 唯一约束（唯一索引）

`UNIQUE`

不允许具有索引值相同的行，从而禁止重复的索引或键值。

和主键的不同：

* 唯一索引允许有NULL值
* 一个表只能有一个主键，但可以有多个唯一索引

##### 外键约束（外键索引）

确保存储在外键表中的数据的数据一致性，完整性。

外键前提：本表列须与外键列类型相同(外键须是外表主键)

外键选择原则：

* 为关联字段创建外键
* 所有的键都必须唯一
* 避免使用复合键
* 外键总是关联唯一的键字段

#### 索引

##### 聚簇索引

聚集索引中键值的逻辑顺序决定了表数据行的物理顺序。所以，一张表只允许存在一个聚簇索引。

一般，主键就是默认的聚簇索引。

##### 组合索引

多个字段组成的索引，称为组合索引。例如：

```mysql
ALTER TABLE t ADD INDEX `idx` (col1, col2, col3)
```

* 适合 WHERE 条件中的多列组合

这相当于建立了三个索引，分别是`(col1)`，`(col1, col2)`，`(col1, col2, col3)`。这就是最左前缀匹配原则的体现。

###### 最左前缀匹配原则

描述起来，大概意思是在where语句中匹配时，mysql会从左一直向右匹配，直到遇到范围查询（`>`、`<`、`between`、`like`）就停止匹配。

* 字段的顺序非常重要

举例来说有索引(a,b,c,d)，则在a=1, b<1, c=1, d=1的匹配过程中，仅a和b是用到索引的，但如果索引是(a,c,d,b)，则a、b、c、d都会用到索引。

##### 覆盖索引

如果查询需要读取到索引中的一个或多个字段，则可以从索引树中直接取得结果集，称为覆盖索引。

也就是说，查询的列就是索引中的列，不再需要回表查询。

##### 部分索引（前缀索引）

部分索引的原因：

* char/varchar 太长全部做索引的话，效率太差，存在浪费
* blob/text 类型不能整列作为索引列，因此需要使用前缀索引

